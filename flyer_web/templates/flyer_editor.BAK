<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>ãƒãƒ©ã‚·å•†å“ç™»éŒ²ãƒ‡ãƒ¢</title>
  <style>
    body {
      font-family: "Meiryo", sans-serif;
      margin: 30px;
      background: #fafafa;
    }
    h1, h3 {
      color: #333;
    }
    label {
      display: inline-block;
      width: 100px;
      margin-top: 5px;
    }
    input[type="text"], input[type="number"] {
      width: 200px;
      padding: 3px;
    }
    select {
      padding: 5px;
      font-size: 14px;
    }
    button {
      padding: 6px 12px;
      margin-top: 10px;
      background-color: #0078d7;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
    button:hover {
      background-color: #005fa3;
    }
    fieldset {
      border: 1px solid #ccc;
      padding: 15px;
      margin-bottom: 20px;
      background: #fff;
    }
    legend {
      font-weight: bold;
      color: #333;
    }
    .row {
      margin-top: 5px;
    }
  </style>
</head>
<body>
  <h1>ğŸ“° ãƒãƒ©ã‚·å•†å“ç™»éŒ²ãƒ‡ãƒ¢</h1>

  <!-- ===================== -->
  <!-- ãƒãƒ©ã‚·é¸æŠ -->
  <!-- ===================== -->
  <fieldset>
    <legend>ãƒãƒ©ã‚·é¸æŠ</legend>
    <label for="flyerSelect">ãƒãƒ©ã‚·:</label>
    <select id="flyerSelect"></select>
    <button id="reloadBtn">å†èª­ã¿è¾¼ã¿</button>
  </fieldset>

  <!-- ===================== -->
  <!-- å•†å“æƒ…å ±å…¥åŠ› -->
  <!-- ===================== -->
  <fieldset>
    <legend>å•†å“æƒ…å ±å…¥åŠ›</legend>

    <div class="row">
      <label for="maker">ãƒ¡ãƒ¼ã‚«ãƒ¼å:</label>
      <input type="text" id="maker" placeholder="ä¾‹ï¼šã‚­ãƒªãƒ³">
    </div>

    <div class="row">
      <label for="name">å•†å“å:</label>
      <input type="text" id="name" placeholder="ä¾‹ï¼šåˆå¾Œã®ç´…èŒ¶">
    </div>

    <div class="row">
      <label for="spec">è¦æ ¼:</label>
      <input type="text" id="spec" placeholder="ä¾‹ï¼š500mlãƒšãƒƒãƒˆ">
    </div>

    <div class="row">
      <label for="price">å£²ä¾¡:</label>
      <input type="number" id="price" placeholder="ä¾‹ï¼š89">
    </div>

    <div class="row">
      <label for="price_tax">ç¨è¾¼ä¾¡æ ¼:</label>
      <input type="number" step="0.01" id="price_tax" placeholder="ä¾‹ï¼š96.12">
    </div>

    <div class="row">
      <label for="each">ã€Œå„ã€è¡¨ç¤º:</label>
      <input type="checkbox" id="each">
    </div>

    <div class="row">
      <label for="row">è¡Œä½ç½®:</label>
      <input type="number" id="row" min="1" placeholder="ä¾‹ï¼š1">
    </div>

    <div class="row">
      <label for="col">åˆ—ä½ç½®:</label>
      <input type="number" id="col" min="1" placeholder="ä¾‹ï¼š1">
    </div>

    <div class="row">
      <label for="grid_w">æ¨ªãƒã‚¹æ•°:</label>
      <input type="number" id="grid_w" min="1" value="1">
    </div>

    <div class="row">
      <label for="grid_h">ç¸¦ãƒã‚¹æ•°:</label>
      <input type="number" id="grid_h" min="1" value="1">
    </div>

    <div class="row">
      <label for="image">ç”»åƒãƒ‘ã‚¹:</label>
      <input type="text" id="image" placeholder="ä¾‹ï¼šC:\\flask_apps\\flyer_web\\img\\sample.jpg">
    </div>

    <div class="row">
      <button id="addItem">å•†å“ã‚’ç™»éŒ²</button>
    </div>
  </fieldset>

  <!-- ===================== -->
  <!-- JSå‡¦ç† -->
  <!-- ===================== -->
  <script>
    // ----------------------
    // ãƒãƒ©ã‚·ä¸€è¦§å–å¾—
    // ----------------------
    async function loadFlyerList() {
      try {
        const res = await fetch('/flyer_list');
        const list = await res.json();
        const select = document.getElementById('flyerSelect');
        select.innerHTML = '';
        list.forEach(f => {
          const opt = document.createElement('option');
          opt.value = f.flyer_id;
          opt.textContent = `${f.flyer_id}: ${f.title} (${f.start}ã€œ${f.end})`;
          select.appendChild(opt);
        });
      } catch (err) {
        alert('ãƒãƒ©ã‚·ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + err);
      }
    }

    // ----------------------
    // å•†å“ç™»éŒ²
    // ----------------------
    async function addItem() {
      const flyerId = document.getElementById('flyerSelect').value;
      if (!flyerId) {
        alert("ãƒãƒ©ã‚·ã‚’é¸æŠã—ã¦ãã ã•ã„");
        return;
      }

      const data = {
        flyer_id: flyerId,
        page_no: 1,
        mnam_k: document.getElementById('maker').value,
        hnam_k: document.getElementById('name').value,
        kika_k: document.getElementById('spec').value,
        retn: document.getElementById('price').value,
        retn_intax: document.getElementById('price_tax').value,
        each_flag: document.getElementById('each').checked ? 1 : 0,
        row_pos: document.getElementById('row').value,
        col_pos: document.getElementById('col').value,
        rowspan: document.getElementById('grid_h').value,
        colspan: document.getElementById('grid_w').value,
        image_path: document.getElementById('image').value,
        remarks: '',
        disp_flag: 1,
        del_flag: 0,
        upnm: 'rinrin'
      };

      try {
        const res = await fetch('/add_item', {
          method: 'POST',
          headers: {'Content-Type': 'application/json'},
          body: JSON.stringify(data)
        });
        const result = await res.json();

        if (result.status === 'ok') {
          alert('âœ… å•†å“ã‚’ç™»éŒ²ã—ã¾ã—ãŸï¼');
        } else {
          alert('âŒ ã‚¨ãƒ©ãƒ¼: ' + result.message);
        }
      } catch (err) {
        alert('é€šä¿¡ã‚¨ãƒ©ãƒ¼: ' + err);
      }
    }

    // ----------------------
    // ã‚¤ãƒ™ãƒ³ãƒˆç™»éŒ²
    // ----------------------
    document.getElementById('reloadBtn').addEventListener('click', loadFlyerList);
    document.getElementById('addItem').addEventListener('click', addItem);
    window.addEventListener('DOMContentLoaded', loadFlyerList);
  </script>
</body>
</html>
