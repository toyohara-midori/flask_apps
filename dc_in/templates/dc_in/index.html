<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>DC入庫発注データアップロード</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 50px;
        }

        .container {
            max-width: 600px;
            margin: auto;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 5px;
        }

        h1 {
            text-align: center;
            color: #333;
        }

        form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        input[type="file"] {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 3px;
        }

        input[type="submit"] {
            padding: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }

            input[type="submit"]:hover {
                background-color: #0056b3;
            }

        /* --- 追加: 区切り線のスタイル --- */
        .separator {
            border: 0;
            height: 1px;
            background: #ccc;
            margin: 40px 0; /* 上下に広めの余白 */
        }

        /* --- リンクエリアのスタイル --- */
        .menu-area {
            text-align: center;
        }

        .nav-link {
            display: inline-block;
            text-decoration: none;
            color: #333;
            font-weight: bold;
            padding: 12px 20px;
            border: 2px solid #aaa; /* 枠線を少し太く */
            border-radius: 5px;
            background-color: #f4f4f4;
            transition: all 0.3s;
        }

            .nav-link:hover {
                background-color: #e2e6ea;
                border-color: #888;
            }
    </style>
    <script>
        function validateForm(event) {
            const fileInput = document.getElementById('csv-file');
            const file = fileInput.files[0];

            // 1. ファイルが選択されているか確認 (required属性もあるが念のため)
            if (!file) {
                alert("ファイルを選択してください。");
                event.preventDefault(); // 送信キャンセル
                return false;
            }

            // 2. 拡張子チェック (.csv)
            const fileName = file.name;
            // 後ろから見て .csv で終わっているか (大文字小文字無視)
            if (!fileName.toLowerCase().endsWith('.csv')) {
                alert("エラー：CSVファイルのみアップロード可能です。\n(.csv形式のファイルを選択してください)");
                event.preventDefault(); // 送信キャンセル
                return false;
            }

            // 3. ファイルサイズチェック (10MB)
            // 10MB = 10 * 1024 * 1024 bytes
            const maxSize = 10 * 1024 * 1024;
            if (file.size > maxSize) {
                // サイズをMB単位に変換して表示
                const sizeInMB = (file.size / (1024 * 1024)).toFixed(2);
                alert(`エラー：ファイルサイズが大きすぎます。\n(上限: 10MB / 選択されたファイル: ${sizeInMB}MB)`);
                event.preventDefault(); // 送信キャンセル
                return false;
            }

            // 問題なければ送信続行
            return true;
        }
    </script>
</head>
<body>
    <div class="container">
        <h1>DC入庫発注データアップロード</h1>

        {% if error_list %}
        <div style="background-color: #ffe6e6; border: 1px solid #ffcccc; color: #cc0000; padding: 15px; margin-bottom: 20px; border-radius: 5px;">
            <h3 style="margin-top: 0; font-size: 1.2em;">⚠ 以下のエラーを修正してください</h3>
            <ul style="margin-bottom: 0; padding-left: 20px;">
                {% for error in error_list %}
                <li style="margin-bottom: 5px;">{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <form method="POST" action="{{ url_for('dc_in.show_confirmation') }}" enctype="multipart/form-data" onsubmit="return validateForm(event)">
            <label for="csv-file">取り込むCSVファイルを選択してください:</label>
            <input type="file" id="csv-file" name="file" accept=".csv" required>
            <input type="submit" value="エラーチェックに進む">
        </form>

        <hr class="separator">
        <div class="menu-area">
            <p>▼ 登録済みデータの検索・表示はこちら</p>
            <a href="{{ url_for('dc_in.voucher_list') }}" class="nav-link">DC入庫伝票一覧・検索</a>
        </div>

        <div class="menu-area" style="margin-top: 40px; border-top: 2px dashed #ccc;">
            <p style="color: #d35400; font-weight: bold;">▼ 管理者メニュー (作業責任者のみ)</p>
            <a href="{{ url_for('dc_in.edit_limits') }}" class="nav-link" style="border-color: #d35400; color: #d35400;">
                入庫上限数量の変更
            </a>
        </div>
    </div>
</body>
</html>