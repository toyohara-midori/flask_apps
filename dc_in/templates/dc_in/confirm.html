<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>DCå…¥åº«ç™ºæ³¨ãƒ‡ãƒ¼ã‚¿ç…§ä¼š</title>
    <style>
        /* === CSSå®šç¾© (å¤‰æ›´ãªã—) === */
        body {
            font-family: Arial, sans-serif;
            margin: 50px;
        }

        .container {
            max-width: 95vw;
            margin: auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #ff8c00;
        }

        p {
            margin-bottom: 20px;
        }

        /* ã‚»ãƒ³ã‚¿ãƒ¼åˆ¥ã®å¤§ããªæ  */
        .center-group-section {
            border: 2px solid #ff8c00;
            padding: 15px;
            margin-bottom: 30px;
            border-radius: 8px;
            background-color: #fffaf0;
        }

        .center-group-header {
            font-size: 1.4em;
            font-weight: bold;
            color: #ff8c00;
            padding-bottom: 10px;
            margin-bottom: 15px;
            border-bottom: 3px double #ff8c00;
        }

        /* ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ»ç´å“æ—¥ã‚°ãƒ«ãƒ¼ãƒ—ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .group-header {
            background-color: #f0f0ff;
            font-weight: bold;
            padding: 10px 5px;
            margin-top: 15px;
            border-bottom: 2px solid #ccc;
            display: flex;
            gap: 20px;
        }

        /* ç´å“æ—¥ã«ã‚ˆã‚‹å¤§ããªåŒºåˆ‡ã‚Š */
        .separator {
            height: 15px;
        }

        /* è©³ç´°ãƒ†ãƒ¼ãƒ–ãƒ«ã®è¨­å®š */
        .detail-table {
            width: 100%;
            border-collapse: collapse;
            table-layout: fixed;
            margin-top: 5px;
        }

            .detail-table th {
                background-color: #e9ecef;
                color: #333;
                font-weight: bold;
                border: 1px solid #ddd;
                padding: 10px;
                text-align: center;
                font-size: 0.8em;
                white-space: nowrap;
            }

            .detail-table td, .detail-table th {
                font-size: 0.9em;
                border: 1px solid #ddd;
                padding: 10px;
            }

            .detail-table tr:nth-child(even) {
                background-color: #f2f2f2;
            }

            /* åˆ—å¹…è¨­å®š */
            .detail-table td:nth-child(1), .detail-table th:nth-child(1) {
                text-align: left;
                width: 4.5%;
            }

            .detail-table td:nth-child(2), .detail-table th:nth-child(2) {
                text-align: left;
                width: 5.5%;
            }

            .detail-table td:nth-child(3), .detail-table th:nth-child(3) {
                text-align: left;
                width: 10.5%;
                white-space: normal;
                word-break: break-all;
            }

            .detail-table td:nth-child(4), .detail-table th:nth-child(4) {
                text-align: left;
                width: 5.0%;
            }

            .detail-table td:nth-child(5), .detail-table th:nth-child(5) {
                text-align: left;
                width: 5.0%;
            }

            .detail-table td:nth-child(n+6) {
                text-align: right;
                min-width: 35px;
                white-space: nowrap;
            }

            .detail-table th:nth-child(6), .detail-table td:nth-child(6) {
                width: 6.5%;
            }

            .detail-table th:nth-child(7), .detail-table td:nth-child(7) {
                width: 6.5%;
            }

            .detail-table th:nth-child(8), .detail-table td:nth-child(8) {
                width: 6.5%;
            }

            .detail-table th:nth-child(9), .detail-table td:nth-child(9) {
                width: 6.5%;
            }

            .detail-table th:nth-child(10), .detail-table td:nth-child(10) {
                width: 6.5%;
            }

            .detail-table th:nth-child(11), .detail-table td:nth-child(11) {
                width: 8.5%;
            }

            .detail-table th:nth-child(12), .detail-table td:nth-child(12) {
                width: 6.5%;
            }

        /* ãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢ */
        .action-buttons {
            margin-top: 30px;
            text-align: center;
        }

            .action-buttons button, .action-buttons a {
                padding: 10px 20px;
                font-size: 16px;
                cursor: pointer;
                margin: 0 10px;
                border: none;
                border-radius: 5px;
                text-decoration: none;
                display: inline-block;
            }

        .confirm-btn {
            background-color: #28a745;
            color: white;
        }

        .back-btn {
            background-color: #6c757d;
            color: white;
        }

        /* å…¨ä½“é›†è¨ˆãƒªã‚¹ãƒˆ */
        .summary-list-table {
            width: 70%;
            margin: 20px auto;
            border-collapse: collapse;
            font-size: 2.0em;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
            text-align: center;
        }

            .summary-list-table th, .summary-list-table td {
                border: 1px solid #ccc;
                padding: 8px;
                text-align: center;
            }

            .summary-list-table th {
                background-color: #ffddb3;
                color: #333;
                font-weight: bold;
            }

            .summary-list-table td:nth-child(3),
            .summary-list-table td:nth-child(4) {
                font-weight: bold;
                text-align: right;
                background-color: #fff8f0;
            }

            .summary-list-table tr:hover {
                background-color: #ffe8d0;
            }

        .summary-row {
            padding: 5px;
            background-color: #f0fff0;
            border-top: 1px solid #ddd;
            border-bottom: 2px solid #28a745;
            margin-top: 5px;
            font-weight: bold;
            display: flex;
            justify-content: space-between;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>DCå…¥åº«ç™ºæ³¨ãƒ‡ãƒ¼ã‚¿ç…§ä¼š</h1>

        <p>
            ä»¥ä¸‹ã®å†…å®¹ã§ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã—ã¾ã™ã€‚ã‚ˆã‚ã—ã‘ã‚Œã°**ã€ç™»éŒ²ã‚’å®Ÿè¡Œã€ãƒœã‚¿ãƒ³**ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
        </p>

        {# --- è©³ç´°ãƒ‡ãƒ¼ã‚¿ã®è¡¨ç¤º --- #}
        <div>
            {% set current_delivery_date = "" %}

            {% for center_name, groups in center_groups.items() %}
            <div class="center-group-section">
                <div class="center-group-header"><strong>{{ center_name }}</strong></div>

                {% set current_delivery_date = "" %}

                {% for group in groups %}

                {% if group.delivery_date != current_delivery_date %}
                {% if current_delivery_date != "" %}
                <div class="separator"></div>
                {% endif %}
                {% endif %}

                <div class="group-header">
                    <span class="group-item">ğŸšš <strong>({{ group.vendor_code }}) {{ group.vendor_name }}</strong></span>
                    <span class="group-item">ğŸ“… <strong>{{ group.delivery_date }}</strong></span>
                </div>

                {# ã‚±ãƒ¼ã‚¹æ•°é›†è¨ˆ #}
                {% set total_cases = namespace(all=0, jv=0, other=0) %}
                {% for detail_row in group.details %}
                {% set case_count = detail_row[6]|int %}
                {% set total_cases.all = total_cases.all + case_count %}
                {% set manufacturer_name = detail_row[4]|string|upper|trim %}
                {% if manufacturer_name[:2] == 'JV' %}
                {% set total_cases.jv = total_cases.jv + case_count %}
                {% else %}
                {% set total_cases.other = total_cases.other + case_count %}
                {% endif %}
                {% endfor %}

                <div style="font-weight: bold; padding: 5px; background-color: #eee; display: flex; justify-content: space-between;">
                    <span>éƒ¨é–€: ({{ group.dept_code }}) {{ group.dept_name }}</span>
                    <span>ğŸ“¦ åˆè¨ˆã‚±ãƒ¼ã‚¹æ•°: {{ total_cases.all }}</span>
                </div>

                <div class="summary-row">
                    <span></span>
                    <span>
                        <strong>JVã‚±ãƒ¼ã‚¹</strong>: <span style="color: #d9534f;">{{ total_cases.jv }}</span> ã‚±ãƒ¼ã‚¹
                        &nbsp;|&nbsp;
                        <strong>å®šç•ªã‚±ãƒ¼ã‚¹</strong>: <span style="color: #5bc0de;">{{ total_cases.other }}</span> ã‚±ãƒ¼ã‚¹
                    </span>
                </div>

                <table class="detail-table">
                    <thead>
                        <tr>
                            <th>å•†å“ã‚³ãƒ¼ãƒ‰</th>
                            <th>JANCD</th>
                            <th>å•†å“å</th>
                            <th>è¦æ ¼</th>
                            <th>ãƒ¡ãƒ¼ã‚«ãƒ¼å</th>
                            <th>ç´å“æ•°</th>
                            <th>ç´å“ã‚±ãƒ¼ã‚¹æ•°</th>
                            <th>æœ¬éƒ¨è²»(MD)</th>
                            <th>ç‰©æµè²»(DC)</th>
                            <th>åŸå˜ä¾¡</th>
                            <th>åˆè¨ˆåŸä¾¡</th>
                            <th>å€¤å¼•ãé‡‘é¡</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for detail_row in group.details %}
                        <tr>
                            <td>{{ detail_row[0] }}</td>
                            <td>{{ detail_row[1] }}</td>
                            <td>{{ detail_row[2] }}</td>
                            <td>{{ detail_row[3] }}</td>
                            <td>{{ detail_row[4] }}</td>
                            <td>{{ detail_row[5] }}</td>
                            <td>{{ detail_row[6]|int }}</td>
                            <td>{{ detail_row[7] }}</td>
                            <td>{{ detail_row[8] }}</td>
                            <td>{{ detail_row[9] }}</td>
                            <td>{{ detail_row[10] }}</td>
                            <td>{{ detail_row[11] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>

                {% set current_delivery_date = group.delivery_date %}
                {% endfor %}
            </div>
            {% endfor %}

        </div>

        {# å…¨ä½“é›†è¨ˆãƒªã‚¹ãƒˆ #}
        <div id="list-add-placeholder">
            <h3>ğŸ“ˆ å…¨ä½“é›†è¨ˆãƒªã‚¹ãƒˆ (ã‚»ãƒ³ã‚¿ãƒ¼ãƒ»ç´å“æ—¥åˆ¥)</h3>
            <table class="summary-list-table">
                <thead>
                    <tr>
                        <th>ã‚»ãƒ³ã‚¿ãƒ¼å</th>
                        <th>ç´å“æ—¥</th>
                        <th>JVã‚±ãƒ¼ã‚¹</th>
                        <th>å®šç•ªã‚±ãƒ¼ã‚¹</th>
                    </tr>
                </thead>
                <tbody>
                    {% for summary in global_summary %}
                    <tr>
                        <td>{{ summary.center }}</td>
                        <td>{{ summary.date }}</td>
                        <td style="color: #d9534f;">{{ summary.jv }}</td>
                        <td style="color: #5bc0de;">{{ summary.other }}</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <div class="action-buttons">
            <form method="POST" action="{{ url_for('dc_in.complete_insertion') }}" style="display: inline;">
                <input type="hidden" name="import_id" value="{{ import_id }}">

                <button type="submit" class="confirm-btn">ç™»éŒ²ã‚’å®Ÿè¡Œ</button>
            </form>

            <a href="{{ url_for('dc_in.home') }}" class="back-btn">ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¦æˆ»ã‚‹</a>
        </div>
    </div>
</body>
</html>